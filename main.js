(()=>{"use strict";var e=document.querySelector(".editor-form"),t=document.querySelector(".add-places"),o=document.forms.place__adder,n=Array.from(document.querySelectorAll(".popup__submit-button"));function c(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function r(e){e?n.forEach((function(e){e.textContent="Сохранение..."})):n.forEach((function(e){e.textContent="Сохранить"}))}function a(e){e.reset()}var i=document.querySelector(".profile"),u=document.querySelector(".profile__edit-button"),s=i.querySelector(".profile__name"),l=i.querySelector(".profile__avatar"),d=i.querySelector(".profile__occupation"),p=i.querySelector(".profile__avatar-edit-button"),f=document.querySelector(".avatar"),m=f.querySelector("#avatar-link"),v=document.forms.avatar__change,h=document.querySelector(".image-popup"),_=document.querySelector(".image-popup__photo"),y=document.querySelector(".image-popup__text"),b=document.querySelector(".places"),S=document.querySelector("#place-name"),C=document.querySelector("#photo-link"),q=document.querySelector("#places__cards").content,E=document.querySelector(".popup__commit-button"),L=document.querySelector(".delete-card");function k(e,t,o,n,c){var r,a=q.querySelector(".places__cards").cloneNode(!0),i=a.querySelector(".places__name"),u=a.querySelector(".places__image"),l=a.querySelector(".places__like-icon"),d=a.querySelector(".places__like-counter"),p=a.querySelector(".places__delete-button");return i.textContent=e,u.src=t,u.alt=e+". Фото живописного места.",""==c.join("")?d.textContent=0:(d.textContent=c.length,c.some((function(e){return e.name===s.textContent}))&&l.classList.add("places__like-icon_enabled")),l.addEventListener("click",(function(e){l.classList.toggle("places__like-icon_enabled"),e.target.classList.contains("places__like-icon_enabled")?(fetch("https://nomoreparties.co/v1/plus-cohort-27/cards/likes/"+"".concat(n),{method:"PUT",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.likes.length})).catch((function(e){return console.error(e)})),d.textContent=c.length+1):(fetch("https://nomoreparties.co/v1/plus-cohort-27/cards/likes/"+"".concat(n),{method:"DELETE",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.likes.length})).catch((function(e){return console.error(e)})),d.textContent=c.length)})),o===s.textContent?((r=p).classList.remove("places__delete-button_inactive"),r.removeAttribute("disabled"),p.addEventListener("click",(function(e){A(L),E.addEventListener("click",(function(e){e.preventDefault(),p.closest(".places__cards").remove(),fetch("https://nomoreparties.co/v1/plus-cohort-27/cards/"+"".concat(n),{method:"DELETE",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"}}).catch((function(e){return console.error(e)})),P(L)}))}))):function(e){e.classList.add("places__delete-button_inactive"),e.setAttribute("disabled","disabled")}(p),u.addEventListener("click",(function(){A(h),_.src=u.src,_.alt=u.alt,y.textContent=i.textContent})),a}function g(e){b.prepend(e)}var j,x=document.querySelector("#name"),T=document.querySelector("#about-yourself");function A(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function z(e,t){e.setAttribute("disabled","disabled"),e.classList.add(t.inactiveButtonClass)}function D(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}(t,o):z(t,o)}j={formSelector:".popup__form",inputSelector:".popup__info",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__info-error",inputErrorTypeClass:"popup__info_type_error",activeInputErrorClass:"popup__info-error_active"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);D(o,n,t),e.addEventListener("reset",(function(){z(n,t)})),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorTypeClass),n.classList.remove(o.activeInputErrorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorTypeClass),c.textContent=o,c.classList.add(n.activeInputErrorClass)}(e,t,t.validationMessage,o)}(e,c,t),D(o,n,t)}))}))}(e,j)}));var B=document.querySelector(".profile__add-button"),O=Array.from(document.querySelectorAll(".popup"));fetch("https://mesto.nomoreparties.co/v1/plus-cohort-27/users/me",{headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){var o,n,c;o=t.name,n=t.avatar,c=t.about,s.textContent=o,l.src=n,d.textContent=c,u.addEventListener("click",(function(){A(e),x.value=s.textContent,T.value=d.textContent})),i.prepend()})).catch((function(e){console.log(e)})),B.addEventListener("click",(function(){A(t)})),e.addEventListener("submit",(function(t){var o,n,c,a;t.preventDefault(),P(e),o=x.value,n=T.value,fetch("https://nomoreparties.co/v1/plus-cohort-27/users/me",{method:"PATCH",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){r(!0)})).catch((function(e){console.log(e)})).finally((function(e){setTimeout((function(){r(!1)}),1e3)})),c=x.value,a=T.value,s.textContent=c,d.textContent=a,r(!0)})),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-27/cards",{headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=Object.entries(e);for(var o in t)for(var n in t[o])n>0&&g(k(t[o][n].name,t[o][n].link,t[o][n].owner.name,t[o][n]._id,t[o][n].likes))})).catch((function(e){console.log(e)})),o.addEventListener("submit",(function(e){var n,c;e.preventDefault(),P(t),g(k(S.value,C.value)),n=S.value,c=C.value,fetch("https://nomoreparties.co/v1/plus-cohort-27/cards",{method:"POST",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"},body:JSON.stringify({name:n,link:c})}).catch((function(e){return console.error(e)})),a(o)})),p.addEventListener("click",(function(){A(f)})),O.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&P(e),t.target.classList.contains("popup__close-button")&&P(e)}))})),v.addEventListener("submit",(function(e){var t,o;e.preventDefault(),P(f),t=m.value,l.src=t,r(!0),o=m.value,fetch("https://nomoreparties.co/v1/plus-cohort-27/users/me/avatar",{method:"PATCH",headers:{authorization:"08ca101b-72c0-46c7-a5af-c036f69dd465","Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){r(!0)})).catch((function(e){console.log(e)})).finally((function(e){setTimeout((function(){r(!1)}),1e3)})),setTimeout((function(){a(v)}),1e3)}))})();